@using EventPlanning.Application.DTOs
@model EditProfileDto

@{
    ViewData["Title"] = "My Profile";

    var initials = (!string.IsNullOrEmpty(Model.FirstName) && !string.IsNullOrEmpty(Model.LastName))
        ? $"{Model.FirstName[0]}{Model.LastName[0]}".ToUpper()
        : "ME";

    var activeTab = ViewBag.ActiveTab as string ?? "profile";
}

<div class="container py-5">

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show shadow-sm mb-4 border-0" style="background-color: #d1e7dd; color: #0f5132;">
            <i class="bi bi-check-circle-fill me-2"></i> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="row g-4">

        <div class="col-lg-4">
            <div class="profile-card shadow-sm">
                <div class="profile-avatar-container">
                    <div class="profile-avatar">
                        @initials
                    </div>
                </div>

                <h2 class="profile-name">@Model.FirstName @Model.LastName</h2>
                <p class="profile-email">@Model.Email</p>

                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-value">@Model.OrganizedCount</span>
                        <span class="stat-label">Organized</span>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat-item">
                        <span class="stat-value">@Model.JoinedCount</span>
                        <span class="stat-label">Joined</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="profile-content-card shadow-sm">

                <ul class="nav nav-tabs-stanza" id="profileTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link @(activeTab == "profile" ? "active" : "")"
                                id="info-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#info"
                                type="button"
                                role="tab">
                            <i class="bi bi-person-gear me-2"></i> Edit Details
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link @(activeTab == "security" ? "active" : "")"
                                id="security-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#security"
                                type="button"
                                role="tab">
                            <i class="bi bi-shield-lock me-2"></i> Security
                        </button>
                    </li>
                </ul>

                <div class="tab-content" id="profileTabsContent">

                    <div class="tab-pane fade @(activeTab == "profile" ? "show active" : "")" id="info" role="tabpanel">
                        <form asp-action="UpdateInfo" method="post">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <label asp-for="FirstName" class="form-label-profile">First Name</label>
                                    <input asp-for="FirstName" class="form-control" placeholder="Enter first name" />
                                    <span asp-validation-for="FirstName" class="text-danger small mt-1 d-block"></span>
                                </div>

                                <div class="col-md-6">
                                    <label asp-for="LastName" class="form-label-profile">Last Name</label>
                                    <input asp-for="LastName" class="form-control" placeholder="Enter last name" />
                                    <span asp-validation-for="LastName" class="text-danger small mt-1 d-block"></span>
                                </div>

                                <div class="col-12">
                                    <label asp-for="PhoneNumber" class="form-label-profile">Phone Number</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light border-end-0"><i class="bi bi-telephone text-muted"></i></span>
                                        <input asp-for="PhoneNumber" class="form-control border-start-0 ps-0" placeholder="+1 (555) 000-0000" />
                                    </div>
                                    <span asp-validation-for="PhoneNumber" class="text-danger small mt-1 d-block"></span>
                                </div>

                                <div class="col-12">
                                    <label class="form-label-profile">Email Address</label>
                                    <input asp-for="Email" class="form-control bg-light text-muted" readonly disabled />
                                    <div class="form-text small mt-2">
                                        <i class="bi bi-info-circle me-1"></i> Email cannot be changed directly for security reasons.
                                    </div>
                                </div>
                            </div>

                            <div class="profile-footer">
                                <button type="submit" class="btn btn-primary px-4 shadow-sm">
                                    Save Changes
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="tab-pane fade @(activeTab == "security" ? "show active" : "")" id="security" role="tabpanel">
                        <form asp-action="ChangePassword" method="post">

                            @if (!ViewData.ModelState.IsValid && ViewData.ModelState.ContainsKey("PasswordError"))
                            {
                                <div class="alert alert-danger border-0 shadow-sm mb-4">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i> @Html.ValidationMessage("PasswordError")
                                </div>
                            }

                            <div class="mb-4">
                                <label class="form-label-profile">Current Password</label>
                                <input name="CurrentPassword" type="password" class="form-control" required />
                            </div>

                            <div class="row g-4 mb-4">
                                <div class="col-md-6">
                                    <label class="form-label-profile">New Password</label>
                                    <input name="NewPassword" type="password" class="form-control" required />
                                    <div class="form-text small mt-1">Must be at least 6 characters long.</div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label-profile">Confirm New Password</label>
                                    <input name="ConfirmPassword" type="password" class="form-control" required />
                                </div>
                            </div>

                            <div class="profile-footer">
                                <button type="submit" class="btn btn-outline-danger px-4">
                                    Update Password
                                </button>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial"/>
}