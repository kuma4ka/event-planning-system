@using EventPlanning.Web.Models.Shared
@using EventPlanning.Domain.Enums
@model EventFilterViewModel

@{
    var dateError = ViewData.ModelState["ToDate"]?.Errors.FirstOrDefault()?.ErrorMessage;
    var hasDateError = !string.IsNullOrEmpty(dateError);
}

<form method="get" asp-controller="@Model.ControllerName" asp-action="@Model.ActionName"
    class="filter-floating-card @(Model.IsHeroOverlay ? "hero-overlay" : "")">
    <div class="filter-bar-unified">
        <!-- Segment 1: Type -->
        <div class="filter-segment">
            <i class="bi bi-grid filter-segment-icon"></i>
            <select name="type" class="form-select" asp-items="Model.TypeOptions" style="cursor: pointer;"
                onchange="this.form.submit()">
            </select>
        </div>

        <!-- Segment 2: Sort -->
        <div class="filter-segment">
            <i class="bi bi-sort-down filter-segment-icon"></i>
            <select name="sortOrder" class="form-select" style="cursor: pointer;" onchange="this.form.submit()">
                <!option value="DateDesc"
                    selected="@(Model.SortOrder == SortOrder.DateDesc || !Model.SortOrder.HasValue)">
                    Newest First</!option>
                <!option value="DateAsc" selected="@(Model.SortOrder == SortOrder.DateAsc)">Oldest First</!option>
                <!option value="NameAsc" selected="@(Model.SortOrder == SortOrder.NameAsc)">Name: A-Z</!option>
                <!option value="NameDesc" selected="@(Model.SortOrder == SortOrder.NameDesc)">Name: Z-A</!option>
            </select>
        </div>

        <!-- Segment 3: From Date -->
        <div class="filter-segment position-relative">
            <i class="bi bi-calendar-event filter-segment-icon"></i>
            <input type="date" name="from" value="@Model.From?.ToString("yyyy-MM-dd")" min="@Model.MinDate"
                title="From Date" onchange="this.form.submit()" placeholder="From Date">

            <!-- Separator Arrow -->
            <div class="filter-segment-date-separator">
                <i class="bi bi-arrow-left-right" style="font-size: 0.8rem;"></i>
            </div>
        </div>

        <!-- Segment 4: To Date -->
        <div class="filter-segment filter-segment-padded-left position-relative">
            <i class="bi bi-calendar-check filter-segment-icon"></i>
            <input type="date" name="to" class="@(hasDateError ? "text-danger" : "")"
                value="@Model.To?.ToString("yyyy-MM-dd")" min="@Model.MinDate" title="To Date"
                onchange="this.form.submit()" placeholder="To Date">

            @if (hasDateError)
            {
                <div class="position-absolute start-0 top-100 mt-2 p-2 rounded shadow bg-white text-danger border border-danger"
                    style="z-index: 100; font-size: 0.75rem;">
                    @dateError
                </div>
            }
        </div>

        @if (Model.HasFilters)
        {
            <!-- Segment 5: Clear (as a button-like segment) -->
            <div class="filter-segment filter-segment-clear text-center"
                onclick="window.location.href='@Url.Action(Model.ActionName, Model.ControllerName, new { viewType = Model.ViewType })'">
                <i class="bi bi-x-lg text-danger"></i>
            </div>
        }
    </div>
</form>
